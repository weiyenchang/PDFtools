<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="pageTitle">您的姓名 - Vibe Coding 作品集</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
<style>
        /* --------------------
            內部 CSS (無印風格樣式 - 維持前一版風格)
        -------------------- */
        :root {
            /* Light Mode Variables */
            --color-primary-text: #333;
            --color-secondary-text: #666;
            --color-background: #fcfcfc;
            --color-button-bg: #eee;
            --color-button-hover: #ddd;
            --color-border: #ccc;
            --color-card-bg: #fff;
            --color-icon: #888;
            --color-tag: #e0e0e0; 
            --color-tag-active: #444;
            --color-modal-overlay: rgba(252, 252, 252, 0.95);
            --shadow-light: 0 2px 5px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.1);
            --color-date-divider: #e0e0e0; /* 日期分隔線顏色 */
        }

        /* Dark Mode Variables */
        html.dark-mode {
            --color-primary-text: #f0f0f0;
            --color-secondary-text: #b0b0b0;
            --color-background: #222222;
            --color-button-bg: #3a3a3a;
            --color-button-hover: #4a4a4a;
            --color-border: #555;
            --color-card-bg: #333333;
            --color-icon: #b0b0b0;
            --color-tag: #4a4a4a;
            --color-tag-active: #f0f0f0;
            --color-modal-overlay: rgba(34, 34, 34, 0.95);
            --shadow-light: 0 2px 5px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.3);
            --color-date-divider: #555;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--color-background);
            color: var(--color-primary-text);
            line-height: 1.6;
            display: flex;
            flex-direction: column; 
            align-items: center; 
            padding: 20px;
            min-height: 100vh; 
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* 頂部固定控制列 (保持不變) */
        .fixed-top-bar { position: fixed; top: 0; right: 0; z-index: 10; display: flex; align-items: center; gap: 15px; padding: 15px 20px; background-color: var(--color-card-bg); box-shadow: 0 0 10px rgba(0, 0, 0, 0.05); border-bottom-left-radius: 8px; }
        #language-select { padding: 8px 12px; border: 1px solid var(--color-border); border-radius: 5px; background-color: var(--color-button-bg); color: var(--color-primary-text); font-size: 0.9rem; cursor: pointer; -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23666666%22%20d%3D%22M287%2069.4L146.2%20208.7L5.4%2069.4h281.6z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat, repeat; background-position: right 10px center, 0 0; background-size: 10px auto, 100%; transition: background-color 0.3s ease; }
        html.dark-mode #language-select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23b0b0b0%22%20d%3D%22M287%2069.4L146.2%20208.7L5.4%2069.4h281.6z%22%2F%3E%3C%2Fsvg%3E'); }
        .fixed-top-bar .search-box { position: relative; width: 200px; }
        .fixed-top-bar #search-input { padding: 8px 12px; padding-right: 35px; font-size: 0.9rem; width: 100%; background-color: var(--color-button-bg); border: 1px solid var(--color-border); color: var(--color-primary-text); }
        .fixed-top-bar .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--color-icon); font-size: 0.9rem; pointer-events: none; }
        .container { width: 100%; max-width: 960px; padding: 80px 20px 40px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .content-tabs { width: 100%; display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; }
        .content-tab-button { background: var(--color-button-bg); border: 1px solid var(--color-border); color: var(--color-primary-text); padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 1.05rem; font-weight: 500; transition: background-color 0.3s ease, color 0.3s ease; }
        .content-tab-button.active { background-color: var(--color-primary-text); color: var(--color-background); border-color: var(--color-primary-text); }
        .post-type { font-size: 0.85rem; color: var(--color-secondary-text); display: inline-block; padding: 2px 6px; border-radius: 4px; background-color: var(--color-tag); font-weight: 500; }
        
        /* --------------------
            近期狀態卡片樣式 (核心變動)
        -------------------- */
        .status-grid {
            display: flex;
            flex-direction: column; 
            gap: 40px; /* 貼文間距 */
            width: 100%;
            text-align: left;
        }

        .post-card {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow-light);
            
            /* 左右兩欄佈局 */
            display: grid;
            grid-template-columns: 150px 1fr; /* 左：日期 150px, 右：內容 1fr */
            gap: 30px;
            align-items: flex-start; /* 頂部對齊 */
        }
        
        /* 左側：日期日曆 (Muji Style) */
        .date-calendar {
            flex-shrink: 0;
            width: 150px;
            text-align: center;
            padding: 10px;
            border-right: 1px solid var(--color-date-divider); /* 柔和分隔線 */
        }
        .date-calendar .month {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--color-secondary-text);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding-bottom: 5px;
        }
        .date-calendar .day {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1;
            color: var(--color-primary-text);
            margin: 5px 0;
        }
        .date-calendar .year {
            font-size: 0.9rem;
            font-weight: 300;
            color: var(--color-secondary-text);
            padding-top: 5px;
        }
        
        /* 右側：內嵌內容容器 */
        .post-embed-content {
            min-width: 0; /* 確保 iframe 不會溢出 */
            width: 100%;
            padding: 0;
        }

        .post-embed-content iframe {
            /* 覆寫內嵌程式碼中寫死的 width/height，實現響應式和統一 UI */
            width: 100%; 
            height: 450px; /* 設定統一的顯示高度 */
            max-width: 504px; /* 限制最大寬度，避免在極寬螢幕上過大 */
            border: 1px solid var(--color-border);
            border-radius: 6px;
            display: block;
            margin: 10px 0 0 0; /* 讓 iframe 居左對齊，與文字/標籤分開 */
            background-color: var(--color-button-bg); /* 統一背景色 */
        }
        
        /* RWD for smaller screens */
        @media (max-width: 600px) {
            .post-card {
                grid-template-columns: 1fr; /* 堆疊日期和內容垂直顯示 */
                gap: 15px;
                padding: 15px;
            }
            .date-calendar {
                border-right: none;
                border-bottom: 1px solid var(--color-date-divider); /* 增加水平分隔線 */
                padding-bottom: 15px;
                margin-bottom: 0;
                width: 100%;
                display: flex; /* 在小螢幕上將月/日/年排成一行 */
                justify-content: center;
                align-items: baseline;
                gap: 10px;
            }
            .date-calendar .day {
                font-size: 2.5rem;
            }
        }

        /* --------------------
            其他不變的基礎樣式 (省略部分重複代碼，確保完整性) 
        -------------------- */
        header { margin-bottom: 30px; width: 100%; }
        .profile-img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; border: 2px solid var(--color-border); box-shadow: var(--shadow-light); }
        h1 { font-weight: 700; font-size: 2rem; margin-bottom: 8px; }
        header p { color: var(--color-secondary-text); font-size: 1.1rem; font-weight: 300; margin-bottom: 20px; }
        .social-links { display: flex; justify-content: center; gap: 25px; margin-bottom: 40px; }
        .social-link { color: var(--color-icon); font-size: 1.6rem; transition: color 0.2s ease, transform 0.2s ease; }
        .social-link:hover { color: var(--color-primary-text); transform: translateY(-2px); }
        .top-controls { width: 100%; display: flex; justify-content: flex-end; align-items: center; gap: 20px; margin-bottom: 30px; }
        .search-box-placeholder { flex-grow: 1; }
        .top-controls .controls { display: flex; gap: 15px; }
        .control-button { background: var(--color-button-bg); border: 1px solid var(--color-border); color: var(--color-primary-text); padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .control-button.active { background-color: var(--color-primary-text); color: var(--color-background); border-color: var(--color-primary-text); }
        html.dark-mode #mode-toggle i.fa-sun { display: none; }
        html:not(.dark-mode) #mode-toggle i.fa-moon { display: none; }
        .tag-cloud { width: 100%; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 40px; }
        .tag-button { background-color: var(--color-tag); color: var(--color-primary-text); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; cursor: pointer; border: 1px solid transparent; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .tag-button.active { background-color: var(--color-tag-active); color: var(--color-background); border-color: var(--color-primary-text); }
        .links-section h2 { font-weight: 700; font-size: 1.5rem; color: var(--color-primary-text); margin-bottom: 25px; position: relative; padding-bottom: 15px; }
        .links-section h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 80px; height: 2px; background-color: var(--color-border); }
        .portfolio-items { display: flex; flex-direction: column; gap: 20px; width: 100%; }
        .portfolio-items.grid-view { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .portfolio-item { display: flex; align-items: center; gap: 15px; text-decoration: none; color: var(--color-primary-text); background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px; padding: 15px; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease; box-shadow: var(--shadow-light); text-align: left; overflow: hidden; cursor: pointer; }
        .portfolio-item.grid-view { flex-direction: column; text-align: center; justify-content: flex-start; height: 100%; padding: 0; }
        .portfolio-thumbnail { width: 100px; height: 80px; object-fit: cover; border-radius: 4px; flex-shrink: 0; border: 1px solid var(--color-border); }
        .portfolio-item.grid-view .portfolio-thumbnail { width: 100%; height: 180px; border-radius: 8px 8px 0 0; border: none; box-shadow: inset 0 -2px 5px rgba(0,0,0,0.05); }
        .portfolio-content { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; gap: 5px; padding-right: 5px; }
        .portfolio-item.grid-view .portfolio-content { padding: 15px; padding-top: 10px; text-align: center; }
        .portfolio-title { font-weight: 700; font-size: 1.1rem; line-height: 1.4; color: var(--color-primary-text); text-overflow: ellipsis; white-space: nowrap; overflow: hidden; }
        .portfolio-description { font-size: 0.9rem; color: var(--color-secondary-text); font-weight: 300; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--color-modal-overlay); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--color-card-bg); color: var(--color-primary-text); padding: 40px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; position: relative; text-align: left; }
        .modal-close { position: absolute; top: 15px; right: 15px; font-size: 2rem; color: var(--color-icon); cursor: pointer; background: none; border: none; transition: color 0.2s ease; }
        .modal-link-btn { display: inline-block; text-decoration: none; background-color: var(--color-primary-text); color: var(--color-background); padding: 10px 20px; border-radius: 5px; font-weight: 500; transition: opacity 0.2s ease; }
        .tool-tag { display: inline-block; background-color: var(--color-tag); color: var(--color-primary-text); padding: 4px 8px; margin-right: 8px; margin-top: 5px; border-radius: 4px; font-size: 0.85rem; }
    </style>
</head>
<body>
    
    <div class="fixed-top-bar">
        
        <select id="language-select">
            <option value="zh-TW">中文 (繁體)</option>
            <option value="en">English</option>
            <option value="ja">日本語</option>
            <option value="ko">한국어</option>
            <option value="it">Italiano</option>
        </select>
        
        <div class="search-box">
            <input type="text" id="search-input" data-key="searchPlaceholder" placeholder="搜尋作品名稱或描述...">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <button id="mode-toggle" class="control-button" data-key="modeToggleBtn" title="切換深色/淺色模式">
            <i class="fas fa-sun"></i><i class="fas fa-moon"></i>
        </button>
    </div>

    <div class="container">
        <header>
            <h1 data-key="name">張瑋晏</h1>
            <p data-key="bio">閱讀寫作 | AI 工具體驗 | 語言學習 | 生活雜記</p>

            <div class="social-links">
                <a href="您的 LinkedIn 連結" target="_blank" class="social-link" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
                <a href="您的 Blogger 連結" target="_blank" class="social-link" title="Blogger"><i class="fab fa-blogger-b"></i></a>
                <a href="您的 Instagram 連結" target="_blank" class="social-link" title="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="您的 GitHub 連結" target="_blank" class="social-link" title="GitHub"><i class="fab fa-github"></i></a>
            </div>
        </header>
        
        <div class="content-tabs">
            <button id="tab-projects" class="content-tab-button active" data-target="projects-section" data-key="projectsTab">作品連結</button>
            <button id="tab-status" class="content-tab-button" data-target="status-section" data-key="statusTab">近期狀態</button>
        </div>
        

        <main class="main-content-wrapper">
            
            <section id="projects-section">
                <div class="top-controls">
                    <div class="search-box-placeholder"></div> 
                    
                    <div class="controls">
                        <button id="list-view-btn" class="control-button active" data-key="listViewBtn" title="列表模式"><i class="fas fa-list"></i></button>
                        <button id="grid-view-btn" class="control-button" data-key="gridViewBtn" title="網格模式"><i class="fas fa-th-large"></i></button>
                    </div>
                </div>

                <div id="tag-cloud" class="tag-cloud">
                    </div>

                <h2 data-key="projectsHeader">作品連結</h2>
                
                <div id="portfolio-items" class="portfolio-items list-view">
                    </div>
            </section>
            
            <section id="status-section" style="display: none;">
                <h2 data-key="statusHeader">最新動態</h2>                
                <div id="status-updates" class="status-grid">
                    </div>
            </section>
            
        </main>

        <footer>
            <p data-key="footerText">&copy; 2025 您的姓名. All rights reserved.</p>
        </footer>
    </div>
    
    <div id="project-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close">&times;</button>
            
            <div class="modal-header">
                <img id="modal-image" src="" alt="專案圖片" style="width: 100%; height: auto; border-radius: 6px; margin-bottom: 20px;">
                <h3 id="modal-title" style="font-size: 1.5rem; margin-bottom: 15px;"></h3>
            </div>

            <div class="modal-details">
                <p style="margin-bottom: 15px;">
                    <strong data-key="modalDescTitle">簡短說明：</strong>
                    <span id="modal-description"></span>
                </p>
                <p style="margin-bottom: 20px;">
                    <strong data-key="modalToolsTitle">使用工具：</strong>
                    <div id="modal-tools" class="tools" style="margin-top: 5px;">
                        </div>
                </p>
                <a id="modal-link" href="#" target="_blank" class="modal-link-btn" data-key="modalLinkBtn">前往作品網站</a>
            </div>
        </div>
    </div>
    
    <script id="status-data" type="application/json">
    {
        "posts": [
            { 
                "id": 1, 
                "type": "linkedin", 
                "date": "2025-10-21", 
                "iframeCode": "<iframe src=\"https://www.linkedin.com/embed/feed/update/urn:li:share:7299434107426484224?collapsed=1\" height=\"670\" width=\"504\" frameborder=\"0\" allowfullscreen=\"\" title=\"Embedded post\"></iframe>"
            },
            { 
                "id": 2, 
                "type": "instagram", 
                "date": "2024-09-15", 
                "iframeCode": "<blockquote class=\"instagram-media\" data-instgrm-captioned data-instgrm-permalink=\"https://www.instagram.com/p/C6718H0F4iE/?utm_source=ig_embed&amp;utm_campaign=loading\" data-instgrm-version=\"14\" style=\" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);\"><div><a href=\"https://www.instagram.com/p/C6718H0F4iE/?utm_source=ig_embed&amp;utm_campaign=loading\" target=\"_blank\">A post shared by Example Creator</a></div></blockquote>"
            },
            { 
                "id": 3, 
                "type": "linkedin", 
                "date": "2024-08-01", 
                "iframeCode": "<iframe src=\"https://www.linkedin.com/embed/feed/update/urn:li:share:7299434107426484224?collapsed=1\" height=\"670\" width=\"504\" frameborder=\"0\" allowfullscreen=\"\" title=\"Embedded post\"></iframe>"
            }
        ]
    }
    </script>

    <script>
        // --------------------
        // JavaScript for All Interactions and Data Management
        // --------------------
        
        // 全域變數初始化
        let translations = {}; // *** 從 GitHub JSON 載入的翻譯文本和 UI 字符串 ***
        let coreProjects = []; // *** 從 GitHub JSON 載入的項目結構數據 (tags, links, images) ***
        let currentLang = localStorage.getItem('lang') || 'zh-TW';
        let activeTag = 'all'; 
        let currentTab = 'projects-section'; 
        let dataLoaded = false;

        // 1. 載入狀態數據 (保持內嵌)
        const statusScript = document.getElementById('status-data');
        const statusData = JSON.parse(statusScript.textContent).posts; 

        // --- 月份名稱查找表 ---
        const monthNames = {
            'zh-TW': ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            'en': ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'],
            'ja': ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
            'ko': ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
            'it': ['GEN', 'FEB', 'MAR', 'APR', 'MAG', 'GIU', 'LUG', 'AGO', 'SET', 'OTT', 'NOV', 'DIC']
        };

        const getMonthName = (monthIndex, lang) => {
            const names = monthNames[lang] || monthNames['en']; 
            return names[monthIndex];
        };
        
        // 2. 異步載入外部 JSON 數據的核心功能 (已修正為處理統一結構)
        async function loadExternalData(url) {
            const portfolioItemsContainer = document.getElementById('portfolio-items');
            
            try {
                // 顯示載入中狀態
                portfolioItemsContainer.innerHTML = '<p style="text-align:center; color:var(--color-secondary-text);">作品數據載入中...</p>';
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}。請確認 GitHub Raw 連結是否公開且正確。`);
                }
                
                const contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    throw new Error("載入的內容不是有效的 JSON 格式。請確認您使用的是 GitHub Raw URL。");
                }

                const data = await response.json();
                
                // --- 解析新結構 ---
                if (!data.translations || !data.coreProjects) {
                     throw new Error("JSON 結構錯誤。頂層應包含 'translations' 和 'coreProjects' 兩個鍵。");
                }
                
                translations = data.translations;
                coreProjects = data.coreProjects; // 儲存核心項目結構

                dataLoaded = true; 
                
                // 數據載入成功後，開始初始化 UI
                const lang = localStorage.getItem('lang') || 'zh-TW';
                setLanguage(lang);
                
            } catch (error) {
                console.error("載入外部作品數據錯誤:", error);
                
                let errorMessage = error instanceof SyntaxError ? 
                    `JSON 語法錯誤 (例如：檔案中含有註釋或多餘逗號)。請檢查 GitHub 上的 projects.json 檔案。` : 
                    error.message;

                portfolioItemsContainer.innerHTML = `<p style="text-align:center; color:red; padding: 20px 0;">無法載入作品數據：${errorMessage}</p>`;
                
                // 載入失敗，提供最小化回退
                const fallbackTranslation = {
                    "pageTitle": "載入失敗", "name": "載入失敗", "bio": "無法取得作品數據", "allProjectsTag": "全部", "projectsHeader": "錯誤", "statusHeader": "錯誤", "searchPlaceholder": "搜尋", "linkedinType": "貼文", "instagramType": "貼文", "modalDescTitle": "簡短說明：", "modalToolsTitle": "使用工具：", "modalLinkBtn": "前往作品網站",
                    "projects": [] // 無法提供任何項目
                };
                translations = { 'zh-TW': fallbackTranslation };
                coreProjects = [];
                setLanguage('zh-TW'); 
            }
        }

        // 3. 語言切換核心函式 (保持不變)
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);

            // 處理語言缺失
            const effectiveLang = translations[lang] ? lang : (translations['zh-TW'] ? 'zh-TW' : null);
            if (!effectiveLang) return;

            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[effectiveLang] && translations[effectiveLang][key]) {
                    if (key === 'searchPlaceholder') {
                        el.placeholder = translations[effectiveLang][key];
                    } else {
                        el.textContent = translations[effectiveLang][key];
                    }
                }
            });

            document.querySelector('title').textContent = translations[effectiveLang].pageTitle;
            document.documentElement.lang = effectiveLang; 
            
            generateTags();
            filterAndRenderProjects(); 
            renderStatusUpdates(); 
            
            document.getElementById('language-select').value = lang;
            switchTab(currentTab, false); 
        }
        
        // --- 輔助函式 ---

        // 4. 合併核心數據和翻譯數據
        function getProjectsData() {
            // 檢查是否已成功載入數據
            if (coreProjects.length === 0 || !translations[currentLang]) {
                 return [];
            }
            
            const translatedProjectsMap = new Map();
            // 建立翻譯數據的 Map，方便 O(1) 查找
            translations[currentLang].projects.forEach(tp => {
                translatedProjectsMap.set(tp.id, tp);
            });
            
            // 合併核心數據與翻譯數據
            return coreProjects.map(coreP => {
                const translatedP = translatedProjectsMap.get(coreP.id);
                // 即使翻譯缺失，也返回核心數據，但使用佔位符文本
                if (!translatedP) {
                    return { 
                        ...coreP, 
                        title: `Project ${coreP.id} (Translation Missing)`, 
                        description: `No translation found in projects.json for this ID.` 
                    };
                }
                // 合併核心數據和翻譯文本
                return { 
                    ...coreP, 
                    title: translatedP.title, 
                    description: translatedP.description 
                };
            });
        }
        
        function switchTab(targetId, filter=true) {
            document.querySelectorAll('.main-content-wrapper section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(targetId).style.display = 'block';
            
            document.querySelectorAll('.content-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-target="${targetId}"]`).classList.add('active');
            
            currentTab = targetId;

            const controls = document.querySelector('.top-controls');
            const tagCloud = document.getElementById('tag-cloud');
            const searchInput = document.getElementById('search-input');
            
            const isProjectTab = currentTab === 'projects-section';
            controls.style.display = isProjectTab ? 'flex' : 'none';
            tagCloud.style.display = isProjectTab ? 'flex' : 'none';
            
            searchInput.value = '';
            if (filter) filterAndRenderProjects(); 
        }
        
        function renderStatusUpdates() {
            const statusContainer = document.getElementById('status-updates');
            statusContainer.innerHTML = '';
            
            const lang = currentLang;

            const warningText = translations[lang] ? (translations[lang].statusHeader ? 
                (lang === 'zh-TW' ? '下方展示您的最新貼文。請注意，社群平台嵌入內容可能因瀏覽器或隱私設定而無法完全顯示。' : 
                'The latest posts are displayed below. Note that embedded content from social media platforms may not fully display due to browser or privacy settings.') : '') : '';
            
            const warning = document.createElement('p');
            warning.style.cssText = 'grid-column: 1 / -1; text-align:center; color:var(--color-secondary-text); margin-bottom: 20px; font-style: italic;';
            warning.textContent = warningText;
            statusContainer.appendChild(warning);

            statusData.forEach(post => {
                const div = document.createElement('div');
                div.classList.add('post-card');
                
                const dateObj = new Date(post.date);
                if (isNaN(dateObj)) return; 
                
                const day = dateObj.getDate().toString().padStart(2, '0');
                const monthIndex = dateObj.getMonth();
                const year = dateObj.getFullYear();
                
                const monthName = getMonthName(monthIndex, lang);
                
                const embedContent = post.iframeCode || '<p>Embed code missing.</p>';
                const typeKey = post.type === 'linkedin' ? 'linkedinType' : 'instagramType';
                const typeText = translations[lang] ? (translations[lang][typeKey] || post.type) : post.type;
                
                div.innerHTML = `
                    <div class="date-calendar">
                        <div class="month">${monthName}</div>
                        <div class="day">${day}</div>
                        <div class="year">${year}</div>
                    </div>
                    
                    <div class="post-embed-content">
                        <span class="post-type">${typeText}</span>
                        
                        <div class="embed-container" style="margin-top: 15px;">
                            ${embedContent}
                        </div>
                    </div>
                `;
                statusContainer.appendChild(div);
            });
        }
        
        function renderProjects(projects) {
            const portfolioItemsContainer = document.getElementById('portfolio-items');
            const currentView = localStorage.getItem('portfolioView') || 'list';
            portfolioItemsContainer.innerHTML = '';
            
            if (projects.length === 0 && dataLoaded) {
                 portfolioItemsContainer.innerHTML = `<p style="text-align:center; color:var(--color-secondary-text); margin-top: 20px;">找不到符合條件的作品。</p>`;
                 return;
            }

            projects.forEach(project => {
                const item = document.createElement('a');
                item.href = "#";
                item.classList.add('portfolio-item');
                item.classList.toggle('grid-view', currentView === 'grid');
                item.dataset.projectId = project.id;
                item.addEventListener('click', (e) => { e.preventDefault(); openModal(project); });
                item.innerHTML = `
                    <img src="${project.image}" alt="${project.title} 縮圖" class="portfolio-thumbnail">
                    <div class="portfolio-content">
                        <span class="portfolio-title">${project.title}</span>
                        <span class="portfolio-description">${project.description}</span>
                    </div>
                `;
                portfolioItemsContainer.appendChild(item);
            });
        }
        function filterAndRenderProjects() {
            if (currentTab !== 'projects-section') return;
            const searchInput = document.getElementById('search-input');
            const projects = getProjectsData(); 
            const searchText = searchInput ? searchInput.value.toLowerCase().trim() : '';
            const filteredProjects = projects.filter(project => {
                const tagMatch = activeTag === 'all' || project.tags.includes(activeTag);
                const searchMatch = project.title.toLowerCase().includes(searchText) || project.description.toLowerCase().includes(searchText);
                return tagMatch && searchMatch;
            });
            renderProjects(filteredProjects);
        }
        function generateTags() {
            if (!translations[currentLang] || !translations[currentLang].allProjectsTag) return; 
            
            const tagCloud = document.getElementById('tag-cloud');
            const projects = getProjectsData(); 
            const allTags = new Set(['all']);
            projects.forEach(p => p.tags.forEach(tag => allTags.add(tag)));
            tagCloud.innerHTML = '';
            allTags.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = 'tag-button';
                btn.dataset.tag = tag;
                btn.textContent = tag === 'all' ? translations[currentLang].allProjectsTag : tag;
                if (tag === activeTag) { btn.classList.add('active'); }
                btn.addEventListener('click', () => {
                    activeTag = tag;
                    document.querySelectorAll('#tag-cloud .tag-button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterAndRenderProjects();
                });
                tagCloud.appendChild(btn);
            });
        }
        function openModal(project) {
            document.getElementById('modal-image').src = project.image;
            document.getElementById('modal-image').alt = project.title;
            document.getElementById('modal-title').textContent = project.title;
            document.getElementById('modal-description').textContent = project.description;
            document.getElementById('modal-link').href = project.link;
            const toolsContainer = document.getElementById('modal-tools');
            toolsContainer.innerHTML = '';
            project.tools.forEach(tool => {
                const tag = document.createElement('span');
                tag.className = 'tool-tag';
                tag.textContent = tool;
                toolsContainer.appendChild(tag);
            });
            document.getElementById('project-modal').classList.add('active');
            document.body.style.overflow = 'hidden'; 
        }
        function closeModal() {
            document.getElementById('project-modal').classList.remove('active');
            document.body.style.overflow = '';
        }
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark-mode');
            const isDarkMode = document.documentElement.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
        }


        // 5. DOM Ready 和初始化
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const listViewBtn = document.getElementById('list-view-btn');
            const gridViewBtn = document.getElementById('grid-view-btn');
            const modeToggleBtn = document.getElementById('mode-toggle');
            const modalOverlay = document.getElementById('project-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const languageSelect = document.getElementById('language-select');
            
            // --- 初始化模式 ---
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'enabled' || (savedDarkMode === null && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark-mode');
            }

            // --- 載入 GitHub 數據 (核心改動) ---
            // *** 請將此處替換為您 GitHub 上 projects.json 檔案的 Raw 連結 ***
            // 範例: const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/YourUsername/YourRepo/main/projects.json';
            const GITHUB_RAW_URL = 'https://weiyenchang.github.io/PDFtools/projects.json'; 
            loadExternalData(GITHUB_RAW_URL);
            
            // --- 設置初始視圖 ---
            let currentView = localStorage.getItem('portfolioView') || 'list';
            function setView(view) {
                const isGrid = view === 'grid';
                const portfolioItemsContainer = document.getElementById('portfolio-items');
                portfolioItemsContainer.classList.toggle('grid-view', isGrid);
                listViewBtn.classList.toggle('active', !isGrid);
                gridViewBtn.classList.toggle('active', isGrid);
                document.querySelectorAll('.portfolio-item').forEach(item => {
                    item.classList.toggle('grid-view', isGrid);
                });
                currentView = view;
                localStorage.setItem('portfolioView', view);
            }
            setView(currentView);
            
            // --- 事件監聽 ---
            languageSelect.addEventListener('change', (e) => setLanguage(e.target.value));
            modeToggleBtn.addEventListener('click', toggleDarkMode);
            searchInput.addEventListener('input', filterAndRenderProjects);
            
            // Tab 監聽
            document.getElementById('tab-projects').addEventListener('click', () => {
                switchTab('projects-section');
            });
            document.getElementById('tab-status').addEventListener('click', () => {
                switchTab('status-section');
            });

            // 佈局切換監聽
            listViewBtn.addEventListener('click', () => setView('list'));
            gridViewBtn.addEventListener('click', () => setView('grid'));
            
            // Modal 監聽
            modalCloseBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) { closeModal(); }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modalOverlay.classList.contains('active')) { closeModal(); }
            });
            
            // 初始化 Tab 顯示 (在 loadExternalData 成功後會再執行一次 setLanguage/switchTab)
            document.getElementById('status-section').style.display = 'none';
            document.getElementById('projects-section').style.display = 'block';
        });
    </script>
</body>
</html>
